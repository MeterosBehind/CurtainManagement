<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>窗帘信息管理页面</title>
    <script src="./js/jquery.min.js"></script>
    <script src="./js/axios.min.js"></script>
    <style>
        .addCurtain {
        background: #f2f2f2;
        height: 30px;
        line-height: 30px;
        padding-left: 5px;
    }</style>
</head>
<body>
<h1>欢迎使用窗帘信息管理系统！</h1>
<a href="/info">查询窗帘信息！</a>
<p id="curtainInfo">窗帘信息</p>
<button id="curtainAdd">新增窗帘</button>
<button id="curtainDelete" disabled>删除窗帘</button>
<button id="curtainEdit" disabled>编辑窗帘</button>
<button id="curtainDetail" disabled>窗帘详细信息</button>
<p>
<table border="1" cellspacing="0">
    <tr>
        <th><input type="checkbox" id="ckAll" name="ckAll" value="0"></th>
        <th width="50px">序号</th>
        <th width="200px">名称</th>
        <th width="400px">简介</th>
        <th width="200px">价格</th>
    </tr>
    <tr>
        <td><input type="checkbox" name="ck" value="11" onclick="fxk()"></td>
        <td>11</td>
        <td>窗帘11</td>
        <td>简介</td>
        <td>11</td>
    </tr>
    <tr>
        <td><input type="checkbox" name="ck" value="12" onclick="fxk()"></td>
        <td>12</td>
        <td>窗帘12</td>
        <td>简介</td>
        <td>12</td>
    </tr>
</table>

<!--添加界面-->
<form id="addCurtain" hidden>
    <p class="addCurtain">新增窗帘</p>
    <div class="">
        <p>
        窗帘名称: <input id="addName" name="name" type="text" placeholder="请输入窗帘名称" /><p>
        窗帘类型: <input id="addType" name="type" type="text" placeholder="请输入窗帘类型" /><p>
        窗帘材质: <input id="addTexture" name="texture" type="text" placeholder="请输入窗帘材质" /><p>
        上市时间: <input id="addMarketDate" name="marketDate" type="datetime-local"/><p>
        窗帘简介: <input id="addIntroduction" name="introduction" type="text" placeholder="请输入窗帘简介" /><p>
        窗帘价格: <input id="addPrice" name="price" type="text" placeholder="请输入窗帘价格（元）" /><p>
        窗帘展示资源: <input id="addResources" name="resList" type="file" accept=".png,.mp4,.jpg" multiple/><p>

        <input type="button" value="保存" id="addConfirm" />
        <input type="button" value="取消" id="addCancel" />
    </div>

</form>
<script>
    window.onload =function() {  //一加载界面就调用
        var list = [];
        $.ajax({
            url:"/info",
            dataType:"json",
            type:"get",
            async:false,
            success:function(data){
                list = data;
            }});
        console.log(list);
        $(list).each(function(i, ele) {
            var $tr = $('<tr><td><input type="checkbox" name="ck" onclick="fxk()" value="'+ (i+1) +'"></td><td>' + (i + 1) + '</td><td class="name">' +
                ele.name + '</td><td>'+ ele.introduction + '</td><td>'+ ele.price + '</td></tr>');
            $('table').append($tr);
        });
        $('table').append($('<tr><td><input type="checkbox" name="ck" value="10" onclick="fxk()"></td><td>10</td><td>窗帘10</td><td>简介</td><td>12</td></tr>'))
    };
    function fxk(){
        var cks = document.getElementsByName("ck");
        var cksLength = 0;
        for(var i=0;i<cks.length;i++){
            if(cks[i].checked==true){
                cksLength++;
            }
        }
        console.log("点击复选框，已选中数量："+cksLength);
        if(cksLength==1){
            document.getElementById("curtainEdit").disabled=false;
            document.getElementById("curtainDetail").disabled=false;
        }else {
            document.getElementById("curtainEdit").disabled=true;
            document.getElementById("curtainDetail").disabled=true;
        }
        if(cksLength==0){
            document.getElementById("curtainDelete").disabled=true;
        }else {
            document.getElementById("curtainDelete").disabled=false;
        }
    };
    $("#curtainAdd").click(function (){
        this.disabled=true;
        $("#addCurtain").show();
    });

    $("#addConfirm").click(function (){
        console.log("新增！");
        var name = document.getElementById("addName").value;
        var type = document.getElementById("addType").value;
        var introduction = document.getElementById("addIntroduction").value;
        var price = document.getElementById("addPrice").value;
        var texture = document.getElementById("addTexture").value;
        var date = document.getElementById("addMarketDate").value;
        if(date == ""){
            window.alert("请输入日期！");
            throw "参数缺失！";
        }else if(price == ""){
            window.alert("请输入价格！");
            throw "参数缺失！";
        }
        $.ajax({
            url:"/add",
            dataType:"json",
            type:"post",
            data: {
                "name":name,
                "type":type,
                "introduction":introduction,
                "price":price,
                "texture":texture,
                "market_time":new Date(date)
            },
            success:function(){
                $("#addCurtain").hide();
                document.getElementById("addName").value="";
                document.getElementById("addType").value="";
                document.getElementById("addIntroduction").value="";
                document.getElementById("addPrice").value="";
                document.getElementById("addTexture").value="";
                document.getElementById("addMarketDate").value="";
                window.alert("新增窗帘信息成功！");
            },
            error:function (res){
                window.alert("新增窗帘信息失败！"+res);
            }
        });
        document.getElementById("curtainAdd").disabled=false;
    });
    $("#addCancel").click(function (){
        $("#addCurtain").hide();
        document.getElementById("curtainAdd").disabled=false;
    });
    $("#curtainDelete").click(function (){
       console.log("删除！")
       var list = document.getElementsByName("ck");
       var idChecked = [];
       var ids = "";
       console.log("全部数据："+list);
       $(list).each(function (i,ele){
           console.log(i);
           if(ele.checked == true){
               var id = $(ele).parents("tr").children("td").get(1).innerHTML;
               var name = $(ele).parents("tr").children("td").get(2).innerHTML;
               idChecked.push(id);
               ids += id+",";
           }
       });
       console.log("已选择："+ids);
       $.ajax({
           url:"/delete",
           data: {
               curtainIds:ids
           },
           type:"get",
           dataType:"json",
           success:function (){
               window.alert("删除窗帘信息："+ids+"已完成！")
           }
       });
    });

    $("#curtainEdit").click(function (){
        var checkedBox = $("input[name=ck]:checked");
        var checked = checkedBox[0].parentNode.parentNode.children;
        var id = checked[1].innerHTML;
        var name = checked[2].innerHTML;
        var introduce = checked[3].innerHTML;
        var price = checked[4].innerHTML;

    });

    $("#ckAll").click(function (){
        var checked = document.getElementsByName("ckAll")[0].checked;
        if (checked){
            qx();
        }else {
            qbx();
        }
    });

    function qx(){
      var cks = document.getElementsByName("ck");
      for (var i=0;i<cks.length;i++){
          cks[i].checked = true;
      }
      document.getElementById("curtainDelete").disabled=false;
      if(cks.length==1){
          document.getElementById("curtainEdit").disabled=false;
          document.getElementById("curtainDetail").disabled=false;
      }
    };

    function qbx(){
        var cks = document.getElementsByName("ck");
        for (var i=0;i<cks.length;i++){
            cks[i].checked = false;
        }
        document.getElementById("curtainDelete").disabled=true;
        document.getElementById("curtainEdit").disabled=true;
        document.getElementById("curtainDetail").disabled=true;
    };
</script>
</body>
</html>